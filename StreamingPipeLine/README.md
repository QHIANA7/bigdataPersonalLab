# 통합 데이터 파이프라인 모듈 개발

## 원본 데이터 구조 분석
### FMS 센서 데이터 구조
* FMS(Factory Management System) 센서 데이터는 JSON 형태로 수집됨
* 장비별 센서값(온도, 습도, 압력), 모터 RPM, 장애상태 포함

### 데이터 타입 정의 및 검증 규칙
| 필드명   | 데이터 타입       | 필수 여부 | 유효 범위      | 비고             |
| -------- | ----------------- | --------- | -------------- | ---------------- |
| time     | String (ISO 8601) | 필수      | 현재 시간 ±1분 | 타임스탬프 검증  |
| DeviceId | Integer           | 필수      | 1-5            | 장비 ID 범위     |
| sensor1  | Float             | 필수      | 0-100          | 온도 센서 (°C)   |
| sensor2  | Float             | 필수      | 0-100          | 습도 센서 (%)    |
| sensor3  | Float             | 필수      | 0-150          | 압력 센서 (PSI)  |
| motor1   | Integer           | 필수      | 0-2000         | 메인 모터 RPM    |
| motor2   | Integer           | 필수      | 0-1500         | 보조 모터 RPM    |
| motor3   | Integer           | 필수      | 0-1800         | 냉각 모터 RPM    |
| isFail   | Boolean           | 필수      | true/false     | 장애 상태 플래그 |

## 데이터 품질 이슈 식별
### 3.3 주요 품질 이슈 유형
* **완전성 문제**
  - NULL/빈 값 존재
  - 필수 필드 누락
  - API 응답 실패

* **정확성 문제**
  - 센서 값 범위 초과
  - 타임스탬프 오류
  - 데이터 타입 불일치

* **일관성 문제**
  - 중복 데이터 수신
  - 시간 순서 역전
  - 장비 ID 불일치

## 전처리 규칙 및 변환 로직 정의
### NULL 값 처리 전략
* **REJECT**: 타임스탬프, 장비 ID, 센서값, 모터 RPM, 장애상태 모두 제거

### 이상치(Outlier) 탐지 및 처리
* **탐지 방법**: 인입 데이터의 유효범위 검증
* **처리 방법**: REJECT

### 데이터 타입 검증 및 변환
* **타임스탬프**: ISO8601 형식 강제, 오류 시 거부
* **장비 ID**: 1-5 범위 정수값, 범위 외 거부
* **센서/모터값**: 자동 형변환 시도, 실패 시 거부

### 장애 데이터 분류 및 저장 정책
* **정상 데이터**: data (HDFS)
* **장애 데이터**: fail (HDFS, 1시간 이내 100건 이상 발생 시 알림 발송)

## Kafka-Spark Streaming 연동
### 실시간 스트리밍 처리 모듈
* **스트림 처리기**: Kafka → Spark Streaming 실시간 연동
* **데이터 파싱**: JSON 스키마 기반 검증 및 변환
* **체크포인트**: 장애 복구를 위한 상태 저장
* **실시간 처리기**: [`src/fms-realtime-processor.py`](src/fms-realtime-processor.py)

### 데이터 파티셔닝 전략
| 데이터 계층화   | 저장 위치        | 파티션 기준             | 보존 기간 |
| -------------- | ---------------- | ---------------------- | ------- |
| 원시 데이터     | `/fms/raw-data`  | year, month, day, hour | 미정    |
| 처리된 데이터   | `/fms/data`      | year, month, day, hour | 미정    |
| 이상 데이터     | `/fms/fail`      | year, month, day, hour | 미정    |
| 장비오류 데이터 | `/fms/dataerr`   | year, month, day, hour | 미정    |

## HDFS 저장 로직 구현
### 계층화 저장 시스템
* **원시 데이터**: JSON 형태, 30초 간격 실시간 저장
* **처리된 데이터**: JSON 형태, 30초 간격 실시간 저장
* **알림 데이터**: JSON 형태, 30초 간격 실시간 저장
* **파티셔닝**: 장비별, 시간별 효율적 분할

## 배치 처리 스케줄링
### 단순 스케줄러 기반 워크플로우
* **데이터 수집**: Kafka 토픽으로 부터 데이터 수집
* **스트림 처리**: Spark 애플리케이션 실행
* **품질 검사**: 데이터 품질 검증 및 리포트

## 파이프라인 아키텍처
```
FMS API → Kafka → Spark Streaming → HDFS
    ↓        ↓         ↓           ↓
  수집기    버퍼링    실시간처리   계층저장
    ↓        ↓         ↓           ↓
  에러처리  재전송    품질검증    백업/복제
```